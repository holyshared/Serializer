//Licence: The MIT Licence
//Author: Noritaka Horio<holy.shared.design@gmail.com>
//Copyright 2011 Noritaka Horio all rights reserved.
(function(){var b=this.Serializer=function(){};var a=b.Container={types:{},get:function(d){if(!this.has(d)){return false}return this.types[d]},register:function(d,e){if(this.has(d)){throw new Error("The specified data type has already been registered.")}this.types[d]=e},unregister:function(d){if(!this.has(d)){throw new Error("The specified data type is not registered.")}delete this.types[d]},has:function(d){if(!this.types[d]){return}return true},find:function(f){var e;for(var d in this.types){e=this.types[d];if(e.match(f)){return e}}return false},serialize:function(e){var d=typeOf(e);var f=this.get(d);return f.serialize(e)},deserialize:function(f){var e,d;if(!(e=this.find(f))){throw new Error("not match")}d=e.compile(f);return e.deserialize(d)}};b.implement({serialize:function(d){return a.serialize(d)},deserialize:function(d){return a.deserialize(d)}});Object.append(b,{register:function(f,e){var d=typeOf(f.prototype);var e=new b.Converter(e);a.register(d,e);return b},unregister:function(e){var d=typeOf(e.prototype);a.unregister(d);return b}});var c=b.Converter=function(d){Object.append(this,d||{})};c.implement({_expression:null,_compileExpression:function(){var d=this.paturn;Object.each(this.params,function(f,e){d=d.replace(":"+e,"(\\"+f+")")});d=d.replace(":",":");this._expression=new RegExp(d,"i");return this._expression},_parse:function(e){var f,d;f=e.match(this._compileExpression());if(f==false){return}f.shift();return f},match:function(d){var e=this._compileExpression();if(!e.test(d)){return}return true},compile:function(e){var d=this._parse(e);try{hash=d.associate(Object.keys(this.params))}catch(f){throw new Error("It failed in the compilation of the restoration pattern of deserialize.")}return hash}})}());
